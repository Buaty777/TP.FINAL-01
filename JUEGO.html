<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="icon" href="LOGO 1.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.T.P (EL JUEGO)</title>
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-image: url('tienda.jpg');
            background-size: cover;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
            overflow: hidden;
        }

        #npc1, #npc2 {
            position: absolute;
            bottom: 20px;
            left: 10%;
            width: 100px;
            display: none;
            transition: transform 0.5s ease, opacity 0.5s ease;
            opacity: 0;
            animation: npcAnimation 1.5s infinite alternate ease-in-out;
        }

        @keyframes npcAnimation {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }

        .panel-dialogo {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            width: 80%;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            display: block;
        }

        .texto-dialogo {
            margin: 0;
            font-size: 18px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .texto-visible {
            opacity: 1;
        }

        .menu-sonido {
            display: none;
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            background-color: rgba(34, 85, 34, 0.8);
            border-radius: 10px;
            padding: 10px;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }

        .boton {
            background-color: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            padding: 10px;
            margin: 5px;
            font-size: 16px;
            transition: transform 0.2s, border-color 0.2s;
        }

        .boton img {
            width: 40px;
            height: 40px;
        }

        .boton:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.6);
        }

        #pantalla-negra {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            display: block;
            z-index: 9999;
        }

        #cuantoPagar {
            background-color: rgba(0, 0, 0, 0.8);
            border: 2px solid white;
            padding: 10px;
            font-size: 20px;
            display: none;
        }

        #botones {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
        }

        #botones .boton {
            margin-bottom: 10px;
        }

        #calculadora {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        #calculadora input {
            width: 100px;
            font-size: 24px;
            text-align: center;
            margin-bottom: 10px;
        }

        #calculadora button {
            font-size: 18px;
            margin: 5px;
            width: 40px;
            height: 40px;
        }
    </style>
</head>
<body>
    <div id="pantalla-negra"></div>
    <img src="npc1.png" alt="NPC 1" id="npc1">
    <img src="npc2.png" alt="NPC 2" id="npc2">

    <div class="panel-dialogo" id="panel-dialogo">
        <p class="texto-dialogo" id="texto-dialogo"></p>
    </div>

    <div class="menu-sonido" id="menu-sonido">
        <p>Menú de Sonido</p>
        <input type="range" min="0" max="100" value="50" class="barra-volumen" id="control-volumen" oninput="cambiarVolumen(this.value)">
        <div>
            <button class="boton" onclick="irAIndex()">
                <img src="salir.png" alt="Salir">
            </button>
            <button class="boton" id="boton-play" onclick="activarPlay()">
                <img src="inicio.png" alt="Iniciar Música">
            </button>
            <button class="boton" id="boton-pausa" onclick="activarPausa()">
                <img src="pausa.png" alt="Pausar Música">
            </button>
        </div>
    </div>

    <div id="botones">
        <button class="boton" id="boton-calculadora" onclick="toggleCalculadora()">
            <img src="calculadora.png" alt="Calculadora">
        </button>

        <button class="boton" id="boton-precios" onclick="togglePrecios()">
            <img src="nota.png" alt="Precios">
        </button>

        <button class="boton" id="boton-sonido" onclick="toggleMenuSonido()">
            <img src="sonido.png" alt="Sonido">
        </button>
    </div>

    <div id="calculadora">
        <input type="text" id="pantalla" readonly>
        <br>
        <button onclick="insertarNumero(1)">1</button>
        <button onclick="insertarNumero(2)">2</button>
        <button onclick="insertarNumero(3)">3</button>
        <br>
        <button onclick="insertarNumero(4)">4</button>
        <button onclick="insertarNumero(5)">5</button>
        <button onclick="operar('+')">+</button>
        <br>
        <button onclick="operar('-')">-</button>
        <button onclick="calcular()">=</button>
        <button onclick="limpiar()">C</button>
    </div>

    <input type="text" id="resultado" placeholder="Ingrese el total" style="width: 50px; margin: 20px;">
    <button class="boton" id="boton-enviar" onclick="enviarResultado()">Enviar</button>

    <div id="cuantoPagar"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.js"></script>
    <script>
        let indiceDialogo = 0;
        const dialogos = [
            `Luego de unos instantes, el abogado (Max) te explicó lo básico. En la parte superior izquierda tienes dos botones, uno te abre una lista la cuál tiene los precios de las cosas y el otro una calculadora, arréglate con eso.`
        ];

        const precios = {
            Jabón: 900,
            Chetos: 1700,
            Refresco: 800,
            Queso: 1200,
            Uranio: 11000
        };

        const dialogoNPC1 = `Ay Holis!!!! Me dices cuanto sería el jabón y dos refrescos tres chetos y un queso plis?`;
        const dialogoNPC2 = `Dame siete quesos...`;
        let npcVisible = 1;

        function mostrarDialogo() {
            if (indiceDialogo < dialogos.length) {
                const dialogoElemento = document.getElementById('texto-dialogo');
                dialogoElemento.classList.add('texto-visible');
                dialogoElemento.textContent = dialogos[indiceDialogo];
                indiceDialogo++;
                setTimeout(() => {
                    dialogoElemento.classList.remove('texto-visible');
                    setTimeout(mostrarNPC, 1000);
                }, 6000);
            }
        }

        function mostrarNPC() {
            if (npcVisible === 1) {
                document.getElementById('npc1').style.display = 'block';
                document.getElementById('npc1').style.opacity = '1';
                document.getElementById('texto-dialogo').textContent = dialogoNPC1;
            } else if (npcVisible === 2) {
                document.getElementById('npc1').style.display = 'none';
                document.getElementById('npc2').style.display = 'block';
                document.getElementById('texto-dialogo').textContent = dialogoNPC2;
            }
        }

        function toggleCalculadora() {
            const calculadora = document.getElementById('calculadora');
            calculadora.style.display = calculadora.style.display === 'block' ? 'none' : 'block';
        }

        function togglePrecios() {
            const hojaPrecios = document.getElementById('cuantoPagar');
            if (hojaPrecios.style.display === 'none' || hojaPrecios.style.display === '') {
                hojaPrecios.style.display = 'block';
                hojaPrecios.innerHTML = Object.entries(precios).map(([producto, precio]) => `${producto} = ${precio}`).join('<br>');
            } else {
                hojaPrecios.style.display = 'none';
            }
        }

        function activarMusica() {
            Tone.start();
            const synth = new Tone.Synth().toDestination();
            const loopMelody = new Tone.Loop((time) => {
                synth.triggerAttackRelease("C4", "8n", time);
                synth.triggerAttackRelease("E4", "8n", time + 0.5);
                synth.triggerAttackRelease("G4", "8n", time + 1);
                synth.triggerAttackRelease("B4", "8n", time + 1.5);
            }, "2n").start(0);

            Tone.Transport.start();
        }

        function cambiarVolumen(volumen) {
            Tone.getDestination().volume.value = volumen - 100;
        }

        function irAIndex() {
            window.location.href = 'index.html';
        }

        function enviarResultado() {
            const resultado = parseInt(document.getElementById('resultado').value);
            let correcto;

            if (npcVisible === 1) {
                correcto = resultado === (precios.Jabón + 2 * precios.Refresco + 3 * precios.Chetos + precios.Queso);
                if (correcto) {
                    document.getElementById('texto-dialogo').textContent = "¡Perfecto! Es correcto.";
                    setTimeout(() => {
                        npcVisible = 2;
                        mostrarNPC();
                    }, 7000);
                } else {
                    document.getElementById('texto-dialogo').textContent = "Mmm, no es el total correcto...";
                }
            } else if (npcVisible === 2) {
                correcto = resultado === (7 * precios.Queso);
                if (correcto) {
                    document.getElementById('texto-dialogo').textContent = "¡Correcto! Muchas gracias.";
                } else {
                    document.getElementById('texto-dialogo').textContent = "Ese no es el total correcto...";
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('pantalla-negra').style.display = 'none';
                mostrarDialogo();
            }, 8000);
            activarMusica();
        });
    </script>
</body>
</html>
